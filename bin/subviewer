#!/bin/bash
# Prepare parameters.
video="$1"

# Start mpv with the given file.
mpv $video &

# Track the PID of the mpv instance.
pid_mpv=$!

sleep 0.5
wmctrl -r "mpv - $video" -e '0,750,0,0,0'

# Watch for changes in the directory of the given file. This is necessary
# to recieve events after the file was deleted.
inotifywait -m -e close_write "$PWD" | while read dir ev file; do
	kill $pid_mpv
done &

# Obtain the PID of inotifywait.
pid_inotify=$(jobs -p | grep -v $pid_mpv)

# If mpv terminates kill the inotifywait process.
wait $pid_mpv
kill $pid_inotify
exec subviewer $video
