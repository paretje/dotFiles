#!/bin/sh
proxy=0

rm -f $HOME/.tsocks.conf
touch $HOME/.tsocks.conf

if [ -f /sys/class/net/ppp0/statistics/rx_bytes ] || /sbin/iwgetid | fgrep -v 'paretjesnetwork' > /dev/null; then
	echo "Start proxy to Paretje's Network"
	sshproxy paretje.online-urbanus.be 1081
	cat >> $HOME/.tsocks.conf <<EOF
local = 127.0.0.0/255.0.0.0
path {
	reaches = 192.168.0.0/255.255.0.0
	server = 127.0.0.1
	server_type = 5
	server_port = 1081
}
fallback = yes
EOF
	proxy=$((proxy+1))
fi

if [ -f /sys/class/net/ppp0/statistics/rx_bytes ] || /sbin/iwgetid | fgrep 'LG-E410i_7795' > /dev/null; then
	echo 'Start compressing proxy'
	sshproxy sshproxy@vps.online-urbanus.be 1080
	cat >> $HOME/.tsocks.conf <<EOF
server = 127.0.0.1
server_type = 5
server_port = 1080
EOF
	proxy=$((proxy+1))
fi

if [ $proxy -gt 0 ]; then
	exec tsocks /usr/bin/iceweasel "$@"
else
	exec /usr/bin/iceweasel "$@"
fi
