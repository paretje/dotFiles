#!/bin/sh
proxy=0

sed -i '/^server/d' $HOME/.tsocks.conf

if [ -f /sys/class/net/ppp0/statistics/rx_bytes ] || /sbin/iwgetid | fgrep -v 'paretjesnetwork' > /dev/null; then
	echo "Start proxy to Paretje's Network"
	sshproxy paretje.online-urbanus.be 1081
	proxy=$((proxy+1))
fi

if [ -f /sys/class/net/ppp0/statistics/rx_bytes ] || /sbin/iwgetid | fgrep 'LG-E410i_7795' > /dev/null; then
	echo 'Start compressing proxy'
	sshproxy sshproxy@vps.online-urbanus.be 1080
	echo "server = 127.0.0.1\nserver_type = 5\nserver_port = 1080" >> $HOME/.tsocks.conf
	proxy=$((proxy+1))
fi

if [ $proxy -gt 0 ]; then
	exec tsocks /usr/bin/iceweasel "$@"
else
	exec /usr/bin/iceweasel "$@"
fi
