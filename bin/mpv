#!/bin/sh
mpv() {
        if test "$HOST" = "kevin-eeepc" && echo "$1" | grep -q '^http://'; then
                /usr/bin/mpv "$(youtube-dl -f best -g "$1")"
	# choose correct hardware acceleration
	elif [ "$VDPAU_DRIVER" = "nouveau" ]; then
		/usr/bin/mpv --profile=vdpau "$@"
	elif [ "$VDPAU_DRIVER" = "va_gl" ]; then
		/usr/bin/mpv --profile=vaapi "$@"
	else
		/usr/bin/mpv "$@"
	fi
}

# do not resume playback when playing multiple files
files=0
smart=true
for arg in "$@"; do
	if [ "$arg" = "--resume-playback" -o "$arg" = "--no-resume-playback" ]; then
		smart=false
	elif [ -f "$arg" ]; then
		files=$((files+1))
	fi
done

# disable notification during playback
pkill -u $USER -USR1 dunst
if $smart && test $files -gt 1; then
	mpv --no-resume-playback "$@"
else
	mpv "$@"
fi
pkill -u $USER -USR2 dunst
