#!/bin/bash -e
qutebrowser() {
	"$HOME/.zplug/bin/qutebrowser" "$@" > /dev/null 2>&1 &
}

clean_history() {
	for location in history local-storage offiline-storage webengine; do
		rm -rf "$HOME/.local/share/qutebrowser/$location"
	done
	sed -i '/^:open/d' "$HOME/.local/share/qutebrowser/cmd-history"
}

qutebrowser_args=()
if [ "$(pgrep -fc qutebrowser)" -eq 0 ] && echo "$1" | grep -vq '^-'; then
	clean_history

	if [ "$HOST" = "parsley" ]; then
		qutebrowser_args+=(--backend webengine ':set --temp content allow-javascript true')
	fi

	if ! 3gusage; then
		qutebrowser_args+=(:adblock-update)
	fi
fi
qutebrowser_args+=("$@")

qutebrowser "${qutebrowser_args[@]}"
exit
