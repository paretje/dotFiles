#!/bin/sh
qutebrowser() {
	"$HOME/.zplug/bin/qutebrowser" "$@" > /dev/null 2>&1 &
}

clean_history() {
	for location in history local-storage offiline-storage webengine; do
		rm -rf "$HOME/.local/share/qutebrowser/$location"
	done
	sed -i '/^:open/d' "$HOME/.local/share/qutebrowser/cmd-history"
}

if [ "$(pgrep -fc qutebrowser)" -gt 1 ] || echo "$1" | grep -q '^-'; then
	qutebrowser "$@"
elif 3gusage; then
	clean_history
	qutebrowser "$@"
else
	clean_history

	if [ "$HOST" = "parsley" ]; then
		qutebrowser --backend webengine ':set --temp content allow-javascript true' :adblock-update "$@"
	else
		qutebrowser :adblock-update "$@"
	fi
fi

exit
