#!/bin/sh
remote="$1"
dir_remote="$2"
dir_local="$3"
options="-rP --rsync-path=/storage/.xbmc/addons/network.backup.rsync/bin/rsync"

ssh $remote "ls -1 $dir_remote | sed '/^lost+found$/d'" | \
while read dir; do
	if [ -d "$dir_local/$dir" ]; then
		echo "$dir"
		rsync -av --delete $options "$dir_local/$dir" "$remote:$dir_remote"
	fi
done
