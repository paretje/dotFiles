nmap x :javascript document.getElementById("hdrAHTButton").click()<CR>
mmap x :javascript document.getElementById("hdrAHTButton").click()<CR>m
nmap r :javascript smartReply()<CR>
nmap / <C-S-k>
nmap <Tab> za
mmap d <C-d>
mmap u <C-u>
nmap ;n /<C-d><ESC>
nmap lo :javascript addMessageToOrg(gMessageDisplay.displayedMessage)<CR>
mmap a :javascript nextAttachment()<CR>m
mmap <CR> :javascript openAttachment()<CR>
mmap A :javascript document.getElementById("attachmentView").childNodes[0].childNodes[3].childNodes[0].childNodes[0].childNodes[1].click()<CR>

javascript <<EOF
function smartReply() {
	var button = document.getElementById("hdrSmartReplyButton");
	for (i=0; i < button.children.length; i++) {
		if (!button.children[i].hidden) {
			button.children[i].click();
			break;
		}
	}
}
EOF
" Source: http://mdn.beonex.com/en/Extensions/Thunderbird/HowTos/Common_Thunderbird_Use_Cases/View_Message.html#Get_Message_Body_by_Header
javascript <<EOF
function getMessageBody(aMessageHeader)
{
  let messenger = Components.classes["@mozilla.org/messenger;1"]
                            .createInstance(Components.interfaces.nsIMessenger);
  let listener = Components.classes["@mozilla.org/network/sync-stream-listener;1"]
                           .createInstance(Components.interfaces.nsISyncStreamListener);
  let uri = aMessageHeader.folder.getUriForMsg(aMessageHeader);
  messenger.messageServiceFromURI(uri)
           .streamMessage(uri, listener, null, null, false, "");
  let folder = aMessageHeader.folder;
  return folder.getMsgTextFromStream(listener.inputStream,
                                     aMessageHeader.Charset,
                                     65536,
                                     32768,
                                     false,
                                     true,
                                     { });
}
EOF
javascript <<EOF
function addMessageToOrg(message) {
	var file = "/home/kevin/vcs/personal/notes/refile.org"
	var item = "* MAIL " + message.mime2DecodedSubject + "\n";
	item += getMessageBody(message) + "\n";
	io.system("cat - | sed 's/\r//;1!s/^/  /;1s/[]:[]//g' >> " + file, item);
}
EOF

javascript <<EOF
function currentAttachment(attachments) {
	for (i=0; i < attachments.childElementCount; i++) {
		if (attachments.childNodes[i].selected == true) {
			return i;
		}
	}
	return -1;
}
function nextAttachment() {
	var attachments = document.getElementById("attachmentView").childNodes[1];
	current = currentAttachment(attachments);
	if (current == -1) {
		attachments.childNodes[0].selected = true;
	} else if (current == attachments.childElementCount-1) {
		attachments.childNodes[current].selected = false;
		attachments.childNodes[0].selected = true;
	} else {
		attachments.childNodes[current].selected = false;
		attachments.childNodes[current+1].selected = true;
	}
}
function openAttachment() {
	var attachments = document.getElementById("attachmentView").childNodes[1];
	current = currentAttachment(attachments);
	if (current != -1) {
		attachments.childNodes[current].selected = false;
		attachments.childNodes[current].click();
	}
}
EOF
